
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>PlotCIExyBorder</title><meta name="generator" content="MATLAB 9.10"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2022-02-12"><meta name="DC.source" content="PlotCIExyBorder.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>PlotCIExyBorder</h1><!--introduction--><p>
 <p style="font-size:75%;">Navigate to: &nbsp;
<a href="JMOSpectrumLibrary.html"> Home</a> &nbsp; | &nbsp;
<a href="AlphabeticList.html"> Alphabetic list</a> &nbsp; | &nbsp;
<a href="GroupedList.html"> Grouped list</a> &nbsp; | &nbsp;
Source code: <a href = "file:../PlotCIExyBorder.m"> PlotCIExyBorder.m</a>
</p>
</p><p>Plot the CIE xy monochromatic border, with optional color fill and other options</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Syntax</a></li><li><a href="#2">Input Arguments</a></li><li><a href="#3">Output Arguments</a></li><li><a href="#4">Algorithm</a></li><li><a href="#5">See also</a></li><li><a href="#6">Usage Example</a></li></ul></div><h2 id="1">Syntax</h2><p><tt>[ah, fh] = PlotCIExyBorder(varargin)</tt></p><h2 id="2">Input Arguments</h2><div><ul><li><tt>varargin</tt>: Optional name-value pairs:</li></ul></div><p>
<p style="margin-left: 25px">
<table border=1>
<tr><td> <b>Name</b>    </td> <td>  <b>Type</b>     </td> <td><b>Value</b>     </td> <td><b>Meaning</b>                              </td></tr>
<tr><td> 'Figure'       </td> <td> handle to figure </td> <td> empty (default) </td> <td> valid figure handle to use for the plot. Current hold state will be restored. When empty, plot into new figure</td></tr>
<tr><td> 'Axes'         </td> <td> handle to axes   </td> <td> empty (default) </td> <td> valid axes handle to use for the plot. Current hold state will be restored. Overrides 'Figure'</td></tr>
<tr><td> 'LineSpec'     </td> <td> string           </td> <td> 'k' (default) </td> <td> valid LineSpec string, e.g. '--b' for dashed blue lines, see 'plot' documentation </td></tr>
<tr><td> 'PlotOptions'  </td> <td> cell array       </td> <td> empty (default) </td> <td> cell array of valid plot options e.g. {'Color',[0.5 0.5 0.5],'LineWidth',2}</td></tr>
<tr><td> 'Ticks'        </td> <td> double vector    </td> <td> reasonable default </td> <td> array of wavelength values where ticks and labels are plotted. Say ...,'Ticks',[],... to suppress ticks</td></tr>
<tr><td> 'TickFontSize' </td> <td> scalar double    </td> <td> 6 (default) </td> <td> Font size for ticks annotation, in points </td></tr>
<tr><td> 'ColorFill'    </td> <td> scalar logical   </td> <td> false (default) </td> <td> When true, fill "shoe" with approximate colors </td></tr>
</table>
</p>
</p><h2 id="3">Output Arguments</h2><div><ul><li><tt>ah</tt>: handle to axes where the border was plotted, to be used for further plotting of e.g. color coordinates</li><li><tt>fh</tt>: handle to figure where the border was plotted, to be used for further plotting.</li></ul></div><h2 id="4">Algorithm</h2><p>Takes the monochromatic border values from the CIE standards and plots it, using the specified options.</p><h2 id="5">See also</h2><p><a href="PlotCIEupvpBorder.html">PlotCIEupvpBorder</a>, <a href="CIE1931_Data.html,">CIE1931_Data</a></p><h2 id="6">Usage Example</h2><pre class="language-matlab">
<span class="keyword">function</span> ExamplePlotCIExyBorder()
    <span class="comment">% bare minimal plot</span>
    PlotCIExyBorder();
    <span class="comment">% more complex example</span>
    fh = figure();
    hold <span class="string">on</span>;
    [ah, fh] = PlotCIExyBorder(<span class="string">'Figure'</span>, fh, <span class="string">'LineSpec'</span>,<span class="string">'m'</span>,<span class="string">'PlotOptions'</span>,{<span class="string">'LineWidth'</span>,1.5},<span class="string">'Ticks'</span>, [510 520 530], <span class="string">'TickFontSize'</span>,10, <span class="string">'ColorFill'</span>,true);
    green = ComputeSpectrumColorimetry(GaussSpectrum(450:600,520,30));
    <span class="comment">% find the point on the monochromatic border corresponding to lDom</span>
    load(<span class="string">'CIE1931_lam_x_y_z.mat'</span>,<span class="string">'CIE1931XYZ'</span>);
    xPure = LinInterpol(CIE1931XYZ.lam, CIE1931XYZ.xBorder, green.Ldom);
    yPure = LinInterpol(CIE1931XYZ.lam, CIE1931XYZ.yBorder, green.Ldom);
    <span class="comment">% plot line from white point, to x/y of green, to border at green.lDom</span>
    plot([1/3,green.XYZ.x,xPure], [1/3,green.XYZ.y,yPure],<span class="string">'--bx'</span>);
    <span class="comment">% result looks as intended, but things like "axis equal", "grid on" etc. are missing when figure or axes are</span>
    <span class="comment">% specified</span>
<span class="keyword">end</span>

</pre><img vspace="5" hspace="5" src="PlotCIExyBorder_01.png" alt=""> <img vspace="5" hspace="5" src="PlotCIExyBorder_02.png" alt=""> <p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2021a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% PlotCIExyBorder
% 
% <html>
%  <p style="font-size:75%;">Navigate to: &nbsp; 
% <a href="JMOSpectrumLibrary.html"> Home</a> &nbsp; | &nbsp;
% <a href="AlphabeticList.html"> Alphabetic list</a> &nbsp; | &nbsp; 
% <a href="GroupedList.html"> Grouped list</a> &nbsp; | &nbsp; 
% Source code: <a href = "file:../PlotCIExyBorder.m"> PlotCIExyBorder.m</a>
% </p>
% </html>
%
% Plot the CIE xy monochromatic border, with optional color fill and other options
%% Syntax
% |[ah, fh] = PlotCIExyBorder(varargin)|
%% Input Arguments
% * |varargin|: Optional name-value pairs:
%
% <html>
% <p style="margin-left: 25px">
% <table border=1>
% <tr><td> <b>Name</b>    </td> <td>  <b>Type</b>     </td> <td><b>Value</b>     </td> <td><b>Meaning</b>                              </td></tr>
% <tr><td> 'Figure'       </td> <td> handle to figure </td> <td> empty (default) </td> <td> valid figure handle to use for the plot. Current hold state will be restored. When empty, plot into new figure</td></tr>
% <tr><td> 'Axes'         </td> <td> handle to axes   </td> <td> empty (default) </td> <td> valid axes handle to use for the plot. Current hold state will be restored. Overrides 'Figure'</td></tr>
% <tr><td> 'LineSpec'     </td> <td> string           </td> <td> 'k' (default) </td> <td> valid LineSpec string, e.g. 'REPLACE_WITH_DASH_DASHb' for dashed blue lines, see 'plot' documentation </td></tr>
% <tr><td> 'PlotOptions'  </td> <td> cell array       </td> <td> empty (default) </td> <td> cell array of valid plot options e.g. {'Color',[0.5 0.5 0.5],'LineWidth',2}</td></tr>
% <tr><td> 'Ticks'        </td> <td> double vector    </td> <td> reasonable default </td> <td> array of wavelength values where ticks and labels are plotted. Say ...,'Ticks',[],... to suppress ticks</td></tr>
% <tr><td> 'TickFontSize' </td> <td> scalar double    </td> <td> 6 (default) </td> <td> Font size for ticks annotation, in points </td></tr>
% <tr><td> 'ColorFill'    </td> <td> scalar logical   </td> <td> false (default) </td> <td> When true, fill "shoe" with approximate colors </td></tr>
% </table>
% </p>
% </html>
%

%% Output Arguments
% * |ah|: handle to axes where the border was plotted, to be used for further plotting of e.g. color coordinates
% * |fh|: handle to figure where the border was plotted, to be used for further plotting.

%% Algorithm
% Takes the monochromatic border values from the CIE standards and plots it, using the specified options.
%% See also
% <PlotCIEupvpBorder.html PlotCIEupvpBorder>, <CIE1931_Data.html, CIE1931_Data>
%% Usage Example
% <include>Examples/ExamplePlotCIExyBorder.m</include>

% publish with publishWithStandardExample('filename.m') in PublishDocumentation.m

% JMO Spectrum Library, 2021. See https://github.com/JuliusMuschaweck/JMO_Spectrum
% I dedicate the JMO_Spectrum library to the public domain under Creative Commons Zero 
% (https://creativecommons.org/publicdomain/zero/1.0/legalcode)
%
%
function [ah, fh] = PlotCIExyBorder(varargin)
    % Plots the CIE xy border "shoe" into a figure and returns the axes and figure handles for further plotting
    %
    % Parameters:
    %   varargin: Name/Value pairs:
    %       'Figure': valid figure handle to use for the plot. Current hold state will be restored
    %       'Axes'  : valid axes handle to use for the plot. Current hold state will be restored.
    %       Overrides 'Figure';
    %       'LineSpec' : valid LineSpec string, e.g. 'REPLACE_WITH_DASH_DASHb' for dashed blue lines, see 'plot' documentation.
    %       'PlotOptions': cell array of valid plot options
    %                   e.g. {'Color',[0.5 0.5 0.5],'LineWidth',2}
    %       'Ticks' : array of wavelength values where ticks and labels are plotted. Reasonable default
    %                   Say ...,'Ticks',[],... to suppress ticks
    %       'TickFontSize': number, obvious use. Default: 6
    %       'ColorFill': logical, fills shoe with approximate RGB colors. Default: false
    p = inputParser;
    p.addParameter('Figure',[], @(h) ishandle(h) && strcmp(get(h,'type'),'figure'));
    p.addParameter('Axes',[], @(h) ishandle(h) && strcmp(get(h,'type'),'axes'));
    p.addParameter('LineSpec','k');
    p.addParameter('PlotOptions',{},@(c) iscell(c));
    defaultTicks = [400, 430, 450:10:480, 485:5:520, 530:10:620, 640, 700];
    p.addParameter('Ticks',defaultTicks,@(x) isempty(x) || (isnumeric(x) && isvector(x)));
    p.addParameter('TickFontSize',6,@(x) isnumeric(x) && isscalar(x));
    p.addParameter('ColorFill',false,@islogical);
    parse(p,varargin{:});
    if isempty(p.Results.Axes)
        if isempty(p.Results.Figure)
            fh = figure();
            ah = axes;
            holdstate = true;
        else
            fh = p.Results.Figure;
            figure(fh);
            ah = gca;
            holdstate = ishold(ah);
        end
    else
        ah = p.Results.Axes;
        fh = ah.Parent;
        holdstate = ishold(ah);
    end
    lspec = p.Results.LineSpec;
    popts = p.Results.PlotOptions;
    blank = isempty(p.Results.Axes) && isempty(p.Results.Figure);
    
    if p.Results.ColorFill
        load('RGBColorShoeImage.mat','rgbimg2');
        im = image([0 1],[1 0],flipud(rgbimg2));
        alph = 1 - (sum(flipud(rgbimg2),3) == 3); % set white to transparent
        im.AlphaData = alph;
        set(gca,'ydir','normal');
    end
    
    load('CIE1931_lam_x_y_z.mat','CIE1931XYZ');
    hold on;
    xb = CIE1931XYZ.xBorder;
    yb = CIE1931XYZ.yBorder;
    xb(end+1)=xb(1); % close loop
    yb(end+1)=yb(1);
    plot(ah,xb,yb,lspec,popts{:});
    if blank
        axis equal;
        grid on;
        if isempty(p.Results.Ticks)
            axis([0 0.8 0 0.9]);
        else
            axis([-0.05,0.9,-0.05,0.9]);
        end
        xlabel('CIE x');
        ylabel('CIE y');
        title('CIE xy border');
    end
    if ~isempty(p.Results.Ticks)
        [b,db] = border(p.Results.Ticks,CIE1931XYZ);
        for i = 1:size(b,1)
            d = [-0.00,0.015];
            plot(b(i,1) + db(i,1) * d, b(i,2) + db(i,2) * d, p.Results.LineSpec);
            text(b(i,1) + 0.035 * db(i,1), b(i,2) + 0.035 * db(i,2),num2str(p.Results.Ticks(i)),...
                'HorizontalAlignment','center','FontSize',p.Results.TickFontSize);
        end
    end
    if ~holdstate
        hold(ah,'off');
    end
end

function ColorFillDemo()
% % This snippet show how we can do color filling:
    figure();
    clf;
    hold on;
    img = imread('Berg.jpg');
    alpha = 0.5 * ones(size(img,1,2));
    alpha(100:1000,100:1000) = 0.2;
    alpha(1000:1800,100:1000) = 0.8;

    % Create a red octagon using the fill function.
    t = (1/16:1/8:1)'*2*pi;
    x = cos(t);
    y = sin(t);
    fill(x,y,'r');
    axis square;
    axis tight;
    % alpha can be anything REPLACE_WITH_DASH_DASH set to 1 outside color shoe
    % we could do this pixel by pixel using LDom/purity, slow but available and we do it only once and save   
    % To get the fill color: Use Rec709 / sRGB to compute rgb within sRGB gamut, and continue with 
    % same color on lines from E to border when outside gamut. 
    imagesc([-1 1],[-1,1],flipud(img),'AlphaData',alpha);
    %imagesc([0 1],[0,1],flipud(img));
    plot([-1 1],[-1 1], 'LineWidth',3);
end

function [xyb, dxyb] = border(lam, CIEXYZ)
    % for lam length n, return xyb border points, and local normal unit vectors outward
    ixb = interp1(CIEXYZ.lam, CIEXYZ.xBorder, lam);
    iyb = interp1(CIEXYZ.lam, CIEXYZ.yBorder, lam);
    xyb = cat(2,ixb(:),iyb(:));
    
    blam = [360, 410:10:600, 830];
    xblam = interp1(CIEXYZ.lam, CIEXYZ.xBorder, blam);
    yblam = interp1(CIEXYZ.lam, CIEXYZ.yBorder, blam);
    
    dxbint = ipp_deriv(pchip(blam, xblam));
    dybint = ipp_deriv(pchip(blam, yblam));
    
    % perpendicular outward
    dixb = - ppval(dybint,lam);
    diyb = ppval( dxbint, lam);
    idxblen = sqrt((dixb(:)).^2 + (diyb(:)).^2);
    dxyb = cat(2,dixb(:)./ idxblen ,diyb(:)./ idxblen);
end
##### SOURCE END #####
--></body></html>